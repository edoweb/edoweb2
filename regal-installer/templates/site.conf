<VirtualHost *:80>
        ServerName $FRONTEND
        ServerAlias $FRONTEND
        ServerAdmin $EMAIL
    DocumentRoot /opt/regal/drupal
    <Directory "/">
    	 Options FollowSymLinks
         AllowOverride None
    </Directory>
    <Directory "/opt/regal/drupal">
               Options Indexes FollowSymLinks
               AllowOverride All
               Order allow,deny
               Allow from all
    </Directory>

    <Proxy http://localhost:$TOMCAT_PORT>
       <Limit POST PUT DELETE>
           order deny,allow
           deny from all
           allow from $IP
       </Limit>
    </Proxy>
    ProxyPassMatch ^/resource/(.*)/data http://localhost:$TOMCAT_PORT/fedora/objects/$1/datastreams/data/content
    ProxyPassReverse ^/resource/(.*)/data http://localhost:$TOMCAT_PORT/fedora/objects/$1/datastreams/data/content

</VirtualHost>

<VirtualHost *:80>
    ServerName $BACKEND
    ServerAlias $BACKEND
    ServerAdmin $EMAIL
    DocumentRoot /opt/regal/html
    <Location "/">
               Options Indexes FollowSymLinks
               Order allow,deny
               Allow from $IP
    </Location>

    ProxyPreserveHost On

    RewriteEngine on

    RewriteRule ^/fedora(.*) http://localhost:$TOMCAT_PORT/fedora$1 [P]
    RewriteRule ^/resource(.*) http://localhost:$TOMCAT_PORT/api/resource$1 [P]
    RewriteRule ^/utils(.*)  http://localhost:$TOMCAT_PORT/api/utils$1 [P]
    RewriteRule ^/dnb-urn(.*)  http://localhost:$TOMCAT_PORT/dnb-urn$1 [P]
    RewriteRule ^/aleph-oai(.*)  http://localhost:$TOMCAT_PORT/aleph-oai$1 [P]
    RewriteRule ^/monograph  http://localhost:$TOMCAT_PORT/api/resource?type=monograph [P]
    RewriteRule ^/journal  http://localhost:$TOMCAT_PORT/api/resource?type=journal [P]


    <Proxy http://localhost:$ELASTICSEARCH_PORT>
       <Limit POST PUT DELETE>
           order deny,allow
           deny from all
           allow from $IP #your IP
      </Limit>
    </Proxy>
    ProxyPass /search http://localhost:$ELASTICSEARCH_PORT
    ProxyPassReverse /search /search http://localhost:$ELASTICSEARCH
</VirtualHost>

